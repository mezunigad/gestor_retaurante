<!doctype html>
<html><head><meta charset="utf-8"><title>Comanda #{{order.id}}</title><link rel="stylesheet" href="/static/style.css">
  <style>
    @media print { button#printbtn{ display:none } }
    .selected-protein { font-weight: bold; color: #d63384; }
  </style>
</head><body>
<header><h1>Comanda - Pedido #{{order.id}}</h1></header>
<main>
  <p>Fecha: {{order.created_at}}{% if order.customer_name %} · Cliente: {{order.customer_name}}{% endif %}</p>
  <table border="0" cellpadding="6">
    <tr><th>Cant</th><th>Producto</th><th>Proteína</th><th>Nota</th><th>Precio</th></tr>
    {% for it in items %}
    <tr>
      <td>{{it.qty}}</td>
      <td>{{it.product_name}}</td>
      <td>
        {% set protein_shown = false %}
        {% if it.note %}
          {% set note_parts = it.note.split(' - ') %}
          {% if note_parts[0] in ['Churrasco', 'Lomito', 'Pollo'] %}
            <span class="selected-protein">{{note_parts[0]}}</span>
            {% set protein_shown = true %}
          {% endif %}
        {% endif %}
        {% if not protein_shown %}
          {{it.base_protein}}
        {% endif %}
      </td>
      <td>
        {% if it.note %}
          {% set note_parts = it.note.split(' - ') %}
          {% if note_parts[0] in ['Churrasco', 'Lomito', 'Pollo'] and note_parts|length > 1 %}
            {{ ' - '.join(note_parts[1:]) }}
          {% elif note_parts[0] not in ['Churrasco', 'Lomito', 'Pollo'] %}
            {{it.note}}
          {% endif %}
        {% endif %}
      </td>
      <td>${{"{:,}".format(it.price * it.qty)}}</td>
    </tr>
    {% endfor %}
  </table>
  <p>Subtotal: ${{"{:,}".format(subtotal)}} · Costo materia prima total: ${{"{:,}".format(total_cost)}}</p>
  <p><strong>— INSTRUCCIONES COCINA —</strong></p>
  <ul>
    {% for it in items %}
      <li>{{it.qty}} x {{it.product_name}} — 
        {% set protein_shown = false %}
        {% if it.note %}
          {% set note_parts = it.note.split(' - ') %}
          {% if note_parts[0] in ['Churrasco', 'Lomito', 'Pollo'] %}
            <strong>{{note_parts[0]}}</strong>
            {% set protein_shown = true %}
            {% if note_parts|length > 1 %} — Nota: {{ ' - '.join(note_parts[1:]) }}{% endif %}
          {% endif %}
        {% endif %}
        {% if not protein_shown %}
          Proteína: {{it.base_protein}}{% if it.note %} — Nota: {{it.note}}{% endif %}
        {% endif %}
      </li>
    {% endfor %}
  </ul>
  <button id="printbtn" onclick="window.print()">Imprimir comanda</button>
  <p><a href="/orders">Volver a hacer otra comanda</a> · <a href="/orders/list">Lista</a></p>
</main>
</body></html>